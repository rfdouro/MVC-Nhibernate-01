function Progress(a){this.el=a,this.loading=0,this.loaded=0}function escolhaFundo(){for(var a=select.value,b=map.getLayers().getArray(),c=0;c<b.length;c++)b[c].setVisible(!1);switch(a){case"OSM":b[0].setVisible(!0);break;case"BingRoad":b[1].setVisible(!0);break;case"BingSatL":b[2].setVisible(!0)}b[3].setVisible(!0)}var wgs84Sphere=new ol.Sphere(6378137);Progress.prototype.addLoading=function(){0===this.loading&&this.show(),++this.loading,this.update()},Progress.prototype.addLoaded=function(){var a=this;setTimeout(function(){++a.loaded,a.update()},100)},Progress.prototype.update=function(){var a=(this.loaded/this.loading*100).toFixed(1)+"%";if(this.el.style.width=a,this.loading===this.loaded){this.loading=0,this.loaded=0;var b=this;setTimeout(function(){b.hide()},500)}},Progress.prototype.show=function(){this.el.style.visibility="visible"},Progress.prototype.hide=function(){this.loading===this.loaded&&(this.el.style.visibility="hidden",this.el.style.width=0)};var progress=new Progress(document.getElementById("progress")),image=new ol.style.Circle({radius:5,fill:new ol.style.Fill({color:"red"}),stroke:new ol.style.Stroke({color:"yellow",width:1})}),bandeira=new ol.style.Style({image:new ol.style.Icon({anchor:[.5,1],src:"http://localhost:8087/imagens/marcas/bandeira_verde.png"})}),styles={Point:bandeira,LineString:new ol.style.Style({stroke:new ol.style.Stroke({color:"green",width:1})}),MultiLineString:new ol.style.Style({stroke:new ol.style.Stroke({color:"green",width:1})}),MultiPoint:new ol.style.Style({image:image}),MultiPolygon:new ol.style.Style({stroke:new ol.style.Stroke({color:"yellow",width:1}),fill:new ol.style.Fill({color:"rgba(255, 255, 0, 0.1)"})}),Polygon:new ol.style.Style({stroke:new ol.style.Stroke({color:"blue",lineDash:[4],width:3}),fill:new ol.style.Fill({color:"rgba(0, 0, 255, 0.1)"})}),GeometryCollection:new ol.style.Style({stroke:new ol.style.Stroke({color:"magenta",width:2}),fill:new ol.style.Fill({color:"magenta"}),image:new ol.style.Circle({radius:10,fill:null,stroke:new ol.style.Stroke({color:"magenta"})})}),Circle:new ol.style.Style({stroke:new ol.style.Stroke({color:"red",width:2}),fill:new ol.style.Fill({color:"rgba(255,0,0,0.2)"})}),bandeiraVerde:new ol.style.Style({image:new ol.style.Icon({anchor:[.5,1],src:"http://localhost:8087/imagens/marcas/bandeira_verde.png"})})},styleFunction=function(a){return styles[a.getGeometry().getType()]},geojsonObject={type:"FeatureCollection",crs:{type:"name",properties:{name:"EPSG:3857"}},features:[{type:"Feature",geometry:{type:"LineString",coordinates:[[4e6,-2e6],[8e6,2e6]]}},{type:"Feature",geometry:{type:"LineString",coordinates:[[4e6,2e6],[8e6,-2e6]]}},{type:"Feature",geometry:{type:"Polygon",coordinates:[[[-5e6,-1e6],[-4e6,1e6],[-3e6,-1e6]]]}},{type:"Feature",geometry:{type:"MultiLineString",coordinates:[[[-1e6,-75e4],[-1e6,75e4]],[[1e6,-75e4],[1e6,75e4]],[[-75e4,-1e6],[75e4,-1e6]],[[-75e4,1e6],[75e4,1e6]]]}},{type:"Feature",geometry:{type:"MultiPolygon",coordinates:[[[[-5e6,6e6],[-5e6,8e6],[-3e6,8e6],[-3e6,6e6]]],[[[-2e6,6e6],[-2e6,8e6],[0,8e6],[0,6e6]]],[[[1e6,6e6],[1e6,8e6],[3e6,8e6],[3e6,6e6]]]]}},{type:"Feature",geometry:{type:"GeometryCollection",geometries:[{type:"LineString",coordinates:[[-5e6,-5e6],[0,-5e6]]},{type:"Point",coordinates:[4e6,-5e6]},{type:"Polygon",coordinates:[[[1e6,-6e6],[2e6,-4e6],[3e6,-6e6]]]}]}}]},vectorSource=new ol.source.Vector({features:(new ol.format.GeoJSON).readFeatures(geojsonObject)});vectorSource.clear();var vectorLayer=new ol.layer.Vector({source:vectorSource,style:styleFunction}),view=new ol.View({projection:"WGS84",center:[-40.30774,-20.31229],zoom:4}),source=new ol.source.OSM;source.on("tileloadstart",function(){progress.addLoading()}),source.on("tileloadend",function(){progress.addLoaded()}),source.on("tileloaderror",function(){progress.addLoaded()});var stylesBing=["Road","Aerial","AerialWithLabels","collinsBart","ordnanceSurvey"],layersBing=[],i,ii;for(i=0,ii=stylesBing.length;i<ii;++i)layersBing.push(new ol.layer.Tile({visible:!1,preload:1/0,source:new ol.source.BingMaps({key:"AvpbdubDKIHpl5c1jfX9jrzXDC7VpZRXdAP_CMFddtSd0wMa2SbXukBIOYFrnfB4",imagerySet:stylesBing[i]})}));var sourceBingRoad=new ol.source.BingMaps({key:"AvpbdubDKIHpl5c1jfX9jrzXDC7VpZRXdAP_CMFddtSd0wMa2SbXukBIOYFrnfB4",imagerySet:"Road"});sourceBingRoad.on("tileloadstart",function(){progress.addLoading()}),sourceBingRoad.on("tileloadend",function(){progress.addLoaded()}),sourceBingRoad.on("tileloaderror",function(){progress.addLoaded()});var sourceBingAerialL=new ol.source.BingMaps({key:"AvpbdubDKIHpl5c1jfX9jrzXDC7VpZRXdAP_CMFddtSd0wMa2SbXukBIOYFrnfB4",imagerySet:"AerialWithLabels"});sourceBingAerialL.on("tileloadstart",function(){progress.addLoading()}),sourceBingAerialL.on("tileloadend",function(){progress.addLoaded()}),sourceBingAerialL.on("tileloaderror",function(){progress.addLoaded()});var map=new ol.Map({layers:[new ol.layer.Tile({source:source}),new ol.layer.Tile({source:sourceBingRoad}),new ol.layer.Tile({source:sourceBingAerialL})],target:"map",controls:ol.control.defaults({attributionOptions:{collapsible:!1}}),view:view});map.addLayer(vectorLayer);var select=document.getElementById("layer-select");select.addEventListener("change",escolhaFundo),escolhaFundo();var addGJSON=function(){$.getJSON("http://localhost:8087/?controle=WebSISADIN.controle.controles.geoLocal.ControleGeoLocal&acao=todosGJSON",function(a){vectorSource.clear();var b=(new ol.format.GeoJSON).readFeatures(a);vectorSource.addFeatures(b)})},contaFeatures=function(){utilJS.exibeAlerta(vectorSource.getFeatures().length)},zoomTo=function(){if(vectorSource.getFeatures().length>0){var a=vectorSource.getExtent();view.fit(a,map.getSize())}},popupMapa=document.getElementById("popup"),popup=new ol.Overlay({element:popupMapa,positioning:"bottom-center",stopEvent:!1});map.addOverlay(popup),map.on("click",function(a){var b=map.forEachFeatureAtPixel(a.pixel,function(a,b){return a});if(b){$(popupMapa).popover("destroy");var c="<p>Você clicou no ponto:</p><code>"+b.get("name")+"</code>",d=b.getGeometry(),e=d.getCoordinates();popup.setPosition(e),$(popupMapa).popover({placement:"top",animation:!1,html:!0,content:c}),$(popupMapa).popover("show")}else $(popupMapa).popover("destroy")});var formatLength=function(a){var b,c=!0;if(c){var d=a.getCoordinates();b=0;for(var e=map.getView().getProjection(),f=0,g=d.length-1;f<g;++f){var h=ol.proj.transform(d[f],e,"EPSG:4326"),i=ol.proj.transform(d[f+1],e,"EPSG:4326");b+=wgs84Sphere.haversineDistance(h,i)}}else b=Math.round(100*a.getLength())/100;var j;return j=b>100?Math.round(b/1e3*100)/100+" km":Math.round(100*b)/100+" m"},testeDist=function(){var a=[[0,0],[10,10]],b=new ol.geom.LineString(a);alert(formatLength(b))};